<!-- templates/admin.html -->
{% extends "base.html" %}
{% block content %}
<div class="admin-container">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <h2>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
  <p>–û–±—â–∏–π —Å—á—ë—Ç: <strong>{{ global_points }}/2026</strong></p>

  <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—â–∏–º —Å—á—ë—Ç–æ–º -->
  <div class="flex">
    <div class="card flex-1">
      <h3>‚ûï –£–≤–µ–ª–∏—á–∏—Ç—å –æ–±—â–∏–π —Å—á—ë—Ç</h3>
      <form method="POST" action="/admin/add_global" class="form-inline">
        <input type="number" name="points" placeholder="10" min="1" max="100" required>
        <button type="submit" class="btn-sm btn-add">–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
    </div>

    <div class="card flex-1">
      <h3>‚ûñ –°–Ω—è—Ç—å —Å –æ–±—â–µ–≥–æ —Å—á—ë—Ç–∞</h3>
      <form method="POST" action="/admin/remove_global" class="form-inline">
        <input type="number" name="points" placeholder="10" min="1" required>
        <button type="submit" class="btn-sm btn-remove">–°–Ω—è—Ç—å</button>
      </form>
    </div>
  </div>

  <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Å—á—ë—Ç–∞ -->
  <div class="card">
    <h3>üåç –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–º–∞–Ω–¥—ã</h3>
    <div class="progress-bar">
      <div class="progress-fill"
           style="width: {{ [global_points * 100 / 2026, 100] | min | round(2) }}%;
                  background: 
                    {% if global_points < 1000 %}#f44336
                    {% elif global_points < 1800 %}#ff9800
                    {% else %}#4caf50{% endif %};">
      </div>
    </div>
    <p style="color: #666; margin: 8px 0;">
      <strong>{{ global_points }}/2026</strong> ‚Äî —Ü–µ–ª—å: —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
    </p>
  </div>

  <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
  <div class="card">
    <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
    <table>
      <thead>
        <tr>
          <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th>–û—Ç–∫—Ä—ã—Ç–æ –¥–Ω–µ–π</th>
          <th>–ë–∞–ª–ª—ã</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ stats.get(user.username, {'total_opened': 0})['total_opened'] }}</td>
          <td>{{ user_points.get(user.username, 0) }}</td>
          <td>
            <div style="display: flex; gap: 8px; flex-direction: column;">
              <!-- –î–æ–±–∞–≤–∏—Ç—å -->
              <form method="POST" action="/admin/add_user_points" class="form-inline">
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <input type="number" name="points" value="10" min="1" max="100">
                <button type="submit" class="btn-sm btn-add">+ –î–æ–±–∞–≤–∏—Ç—å</button>
              </form>

              <!-- –°–Ω—è—Ç—å -->
              <form method="POST" action="/admin/remove_user_points" class="form-inline">
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <input type="number" name="points" value="10" min="1">
                <button type="submit" class="btn-sm btn-remove">‚àí –°–Ω—è—Ç—å</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

    <!-- –õ–∏—á–Ω—ã–µ –ø—Ä–∏–∑—ã -->
  <div class="card">
    <h3>üéØ –õ–∏—á–Ω—ã–µ —Ü–µ–ª–∏ (–ø–æ –∏–≥—Ä–æ–∫–∞–º)</h3>
    <p style="color: #666; font-size: 14px; margin: 0 0 12px;">–¶–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –Ω–∞–±—Ä–∞–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ <strong>–ª–∏—á–Ω—ã—Ö</strong> –±–∞–ª–ª–æ–≤</p>
    <table>
      <thead>
        <tr>
          <th>–ü—Ä–∏–∑</th>
          <th>–¶–µ–ª—å</th>
          {% for user in users %}
            <th>{{ user.username }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for r in reward_targets['personal'] %}
        <tr>
          <td><strong>{{ r['name'] }}</strong></td>
          <td style="color: #777;">{{ r['points'] }}</td>
          {% for user in users %}
            {% set total = user_points.get(user.username, 0) %}
            <td class="status-cell">
              {% if total >= r['points'] %}
                <span class="status-achieved">‚úÖ</span>
              {% else %}
                <span class="status-pending">‚¨ú</span>
              {% endif %}
            </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- –ö–æ–º–∞–Ω–¥–Ω—ã–µ –ø—Ä–∏–∑—ã -->
  <div class="card">
    <h3>üåç –ö–æ–º–∞–Ω–¥–Ω—ã–µ —Ü–µ–ª–∏</h3>
    <p style="color: #666; font-size: 14px;">
      –ü—Ä–∏–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ <strong>–æ–±—â–µ–≥–æ</strong> —Å—á—ë—Ç–∞.
    </p>
    <table>
      <thead>
        <tr>
          <th>–ü—Ä–∏–∑</th>
          <th>–¶–µ–ª—å</th>
          {% for user in users %}
            <th>{{ user.username }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for r in reward_targets['global'] %}
        <tr>
          <td><strong>{{ r['name'] }}</strong></td>
          <td style="color: #777;">{{ r['points'] }}</td>
          {% for user in users %}
            <td class="status-cell">
              {% if global_points >= r['points'] %}
                <span class="status-achieved">‚úÖ</span>
              {% else %}
                <span class="status-pending">‚¨ú</span>
              {% endif %}
            </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- –°—Å—ã–ª–∫–∏ -->
  <div style="text-align: center; margin: 24px 0;">
    <a href="/admin/submissions" class="btn" style="background: #1976d2;">üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</a>
    <a href="/calendar" class="btn btn-outline" style="margin-left: 12px;">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é</a>
  </div>

</div>

{% endblock %}






